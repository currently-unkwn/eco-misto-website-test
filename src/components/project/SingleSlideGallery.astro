---
// Tools
import { Picture } from "astro:assets";

import Frame from "../compositions/Frame.astro";
import ArrowIcon from "../ui/ArrowIcon.astro";
import Center from "../compositions/Center.astro";
import Cluster from "../compositions/Cluster.astro";
import Stack from "../compositions/Stack.astro";

// Compositions

// Components

// Data

type Props = {
  imagePaths: string[];
};
const { imagePaths } = Astro.props;

// Assets

// Collect all images in given path
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/content/projects/images/**/*.{jpeg,jpg}"
);

imagePaths.forEach((imagePath) => {
  const newPath = `/src/content/projects/${imagePath}`;

  if (!images[newPath])
    throw new Error(
      `"${imagePath}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`
    );
});
---

<div class="single-slide-gallery">
  <div class="single-slide-swiper swiper">
    <div class="swiper-wrapper">
      {
        imagePaths?.map((imagePath) => {
          const newPath = `/src/content/projects/${imagePath}`;

          return (
            <div class="swiper-slide ">
              <Frame ratio="3:4" class="img-wrapper">
                <Picture
                  src={images[newPath]()}
                  width={1100}
                  formats={["avif", "webp"]}
                  alt=""
                  densities={[1.5, 2]}
                />
              </Frame>
            </div>
          );
        })
      }
    </div>

    <div class="swiper-navigation">
      <div class="swiper-buttons">
        <div class="swiper-button swiper-button-prev">
          <ArrowIcon
            style="primary"
            direction="left"
            class="swiper-button"
            isOutline
          />
        </div>
        <div class="swiper-button swiper-button-next">
          <ArrowIcon style="primary" isOutline />
        </div>
      </div>
    </div>
  </div>

  <div class="annotation">
    <slot />
  </div>
</div>

<style>
  .single-slide-swiper {
    position: relative;
    isolation: isolate;
  }

  .swiper-buttons {
    display: flex;
    gap: var(--space-2-fixed);
  }

  .swiper-button {
    cursor: pointer;
  }

  .swiper-navigation {
    --_position: var(--space-8-fixed);
    position: absolute;
    right: var(--_position);
    bottom: var(--_position);
    z-index: 10;
  }

  .annotation {
    margin-block-start: var(--space-4-fixed);
    text-align: center;

    & > :global(p) {
      font-size: var(--text-minus-1);
      color: var(--color-gray-400);
    }
  }
</style>
